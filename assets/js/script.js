// Array of animals to be scrambled into anagrams
let animals = [
    {
        name: "elephant",
        clue: "The biggest land animal in the world."
    },
    {
        name: "lion",
        clue: "The king of the big cats."
    },
    {
        name: "cheetah",
        clue: "The fastest land animal in the world."
    },
    {
        name: "giraffe",
        clue: "An animal with a long neck for reaching leaves."
    },
    {
        name: "penguin",
        clue: "A flightless bird from Antarctica."
    },
    {
        name: "spider",
        clue: "A creepy-crawly with eight legs."
    },
    {
        name: "dolphin",
        clue: "A super speedy, high-jumping marine mammal."
    },
    {
        name: "gorilla",
        clue: "A big, strong forest primate."
    },
    {
        name: "crocodile",
        clue: "A scaly, snappy river reptile."
    },
    {
        name: "rhino",
        clue: "A powerful charger with a horn on its nose."
    }
];

// Add click event listener to start button after the DOM has finished loading
document.addEventListener("DOMContentLoaded", function() {
    
    let startBtn = document.getElementById("start");
    startBtn.addEventListener("click", displayGame);

});

/**
 * Hides intro screen and begins game
 */ 
function displayGame() {
    
    let introArea = document.querySelector(".intro-area");
    introArea.classList.add("hidden");

    let gameArea = document.querySelector(".game-area");
    gameArea.classList.remove("hidden");

    runGame();
    
}

let randomAnimal;

/** 
 * Main game function displays anagram and clue
 */ 
function runGame() {

    document.getElementById("answer-box").value = ""; // always clear and select input field 
    document.getElementById("answer-box").focus(); 
    
// Choose random animal from array and split its name into an array letter by letter
    randomAnimal = animals[Math.floor(Math.random() * animals.length)];
    let animalLetters = randomAnimal.name.split("");

    // Loop and swap pairs of letters backwards as indices through the name's array
        for (let i = animalLetters.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [animalLetters[i], animalLetters[j]] = [animalLetters[j], animalLetters[i]];
    }

    let anagram = document.getElementById("name");
    anagram.innerText = animalLetters.join(""); // display anagram for users without commas

    let clue = document.querySelector(".clue span");
    clue.innerText = randomAnimal.clue; // display clue for users

}

// checkAnswer event listeners
const checkBtn = document.getElementById("submit");
checkBtn.addEventListener("click", checkAnswer);

document.getElementById("answer-box").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
        checkAnswer();
    }
});

let feedbackMessage = document.getElementById("feedback");

/**
 * Pass button click shows the answer, removes passed animal from the array,
 * skips to the next anagram or ends the game
 */ 
const passBtn = document.getElementById("pass");

passBtn.addEventListener("click", function() {
    let randomIndex = animals.indexOf(randomAnimal);
    if (animals.length > 1) {
        animals.splice(randomIndex, 1);
        feedbackMessage.innerText = `Oops! The answer was ${randomAnimal.name}.`;
        setTimeout(() => {
            feedbackMessage.innerText = "";
            runGame();
        }, 3500);
    } else {
        feedbackMessage.innerText = `Oops! The answer was ${randomAnimal.name}.`;
        setTimeout(() => {
            endGame();
        }, 3500);
    }
});

/**
 * Checks the user's attempt against the name of the random animal generated by runGame,
 * displays feedback and removes checked animal from the array
 */ 
function checkAnswer() {

    let userAnswer = document.getElementById("answer-box").value;
    
    if (userAnswer.toLowerCase() === randomAnimal.name) { // displays right or wrong message
        feedbackMessage.innerText = "Well done! That was the right answer!";
        incrementScore(); // adds one point for a correct answer
    } else {
        feedbackMessage.innerText = `Oops! The answer was ${randomAnimal.name}.`;
    }

    // Remove previously displayed animals in turn from the array to avoid repeats
    let randomIndex = animals.indexOf(randomAnimal);
    if (animals.length > 1) {
        animals.splice(randomIndex, 1);
        setTimeout(() => {
            feedbackMessage.innerText = "";
            runGame();
        }, 3500);
    } else {
        setTimeout(() => {
            endGame();
        }, 3500);
    }

}

/**
 * Reads the score as an integer in the html paragraph and adds 1
 */ 
function incrementScore() {

    let runningScore = parseInt(document.getElementById("score").innerText);
    document.getElementById("score").innerText = ++runningScore;

}

/**
 * Displays user's final score, message and option to start again
 */ 
function endGame() {

    let introArea = document.querySelector(".intro-area");
    introArea.classList.remove("hidden");

    let gameArea = document.querySelector(".game-area");
    gameArea.classList.add("hidden");

    let runningScore = parseInt(document.getElementById("score").innerText);
    let message = document.getElementById("message");

    // Set score bands for final message
    if (runningScore <= 5) {
        message.innerText = `Good try! Your score was ${runningScore}/10, a bit lost in the wild.`;
    } else if (runningScore <= 8) {
        message.innerText = `Great effort! Your score was ${runningScore}/10, a succesful safari!`;
    } else if (runningScore <=10) {
        message.innerText = `Incredible! Your score was ${runningScore}/10, top of the food chain!`;
    }

    // Adjusts button text to "Play again" and reloads intro screen
    let startBtn = document.getElementById("start");
    startBtn.innerText = "Play again";
    startBtn.removeEventListener("click", displayGame); // avoids premature game reload
    startBtn.addEventListener("click", function() {
        location.reload();
    });
    
}